---
description: "specファイルの曖昧な点を深掘りして明確化する"
version: "3.0.0"
allowed-tools:
  - Write
  - Edit
  - Read
  - Grep
  - Glob
  - TodoRead
  - TodoWrite
  - AskUserQuestion
context: fork
---

`/chore` コマンドで作成された `.cckiro/specs/{slug}/spec.md` を読み込み、AskUserQuestionツールを使ってユーザーに詳細なインタビューを行い、specファイルを充実させます。

## 対象ファイル

- `.cckiro/specs/{slug}/spec.md` （統合specファイル）
- slugが不明な場合は `.cckiro/specs/` ディレクトリを確認し、最新のspecファイルを対象とする

## フェーズ

### フェーズ1: specファイルの分析

1. `.cckiro/specs/` ディレクトリから対象のspecファイルを特定
2. specファイルを読み込み、以下の観点で曖昧な点を洗い出す：
   - **要件定義**: 機能要件の詳細、非機能要件の具体的な数値、制約事項の範囲
   - **設計**: アーキテクチャの選択理由、コンポーネント間の依存関係、エラーハンドリングの方針
   - **実装計画**: ステップの粒度、テスト方針の詳細、リリース手順
3. 曖昧な点をリストアップ

### フェーズ2: インタビュー（繰り返し）

<rules>
- 質問数: **2-4個**（曖昧さのレベルに応じて調整）
- 各質問には **2-4個の具体的な選択肢** を用意
- 各選択肢には **簡潔なpros/cons** を含める
- オープンエンドな質問は避ける
- 「その他」オプションは自動追加されるので含めない
- CLAUDE.mdに記載されているパターンがあれば、それに合わせる
</rules>

以下の観点を深掘りする：
- プロダクトの仕様詳細
- 技術的な実装詳細
- UI/UXの方針
- エッジケースの処理
- パフォーマンス要件の具体値
- セキュリティ要件
- その他、曖昧な点すべて

### フェーズ3: 決定事項の適用

ユーザーの回答を受けて、以下の形式で決定事項を整理：

```markdown
## 決定事項

| 項目 | 選択 | 理由 | 備考 |
|------|------|------|------|
| [項目名] | [選択内容] | [選択理由] | [追加メモ] |
```

### フェーズ4: specファイルの更新

1. 決定事項をspecファイルの該当セクションに反映
2. 更新後、再度specファイルを分析
3. まだ曖昧な点があればフェーズ2に戻る
4. すべて明確になったらユーザーにサマリーを提示

### フェーズ5: 完了サマリー

```markdown
## 深掘り完了サマリー

### 更新されたセクション
- [更新されたセクション1]: [変更概要]
- [更新されたセクション2]: [変更概要]

### 主な決定事項
1. [決定事項1]
2. [決定事項2]

### specファイルの状態
- 要件定義: ✅ 完了
- 設計: ✅ 完了
- 実装計画: ✅ 完了

次のステップ: `/implement` で実装を開始できます
```

---

## 重要事項

- **必ずAskUserQuestionツールを使用** - 会話形式ではなくツールを使う
- **言語**: 日本語で質問・回答を行う（CLAUDE.mdの設定に従う）
- 各選択肢には **pros/cons** を必ず含める
- multiSelectは控えめに使用（デフォルト: false）
- 質問前にCLAUDE.mdを読み、プロジェクトのパターンに合わせる
- 曖昧な点がすべて解消されるまで繰り返しインタビューを続ける
